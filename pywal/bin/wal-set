#!/usr/bin/env bash

notify-send "[wal-set] init" -t 1

sdim="$(xdpyinfo | grep dimensions | tr -s ' ' | cut -d' ' -f3)"
notify-send "Detected screen dimensions: ${sdim}"

WALLP="${HOME}/Wallpapers-${sdim}/Originals"
if [ ! -d "$WALLP" ]; then
    notify-send "Directory ${WALLP} not found. Exiting."
    exit 1
fi

if [[ "$1" == 'list' ]]; then
    printf '%s\n' "$(ls "$WALLP")"
    exit 1
elif [[ "$1" == 'useprev' ]] && \
   [[ -f "${HOME}/.cache/wal/wal" ]]; then
    WALLP="$(< "${HOME}/.cache/wal/wal")"
else
    CATEGORY="${WALLP}/${1}"
    if [[ -d "$CATEGORY" ]]; then
        WALLP="$CATEGORY"
        notify-send "[wal-set] using category ${1}" -t 1
    else
        printf '%s\n' "Directory ${CATEGORY} does not exist."
        exit 1
    fi
fi

wal -i "$WALLP" -a 75

# NOTE: wal automatically reloads polybar. Only dunst needs to be reloaded.
pkill dunst

# Reload bspwm and dunst colors.
xrdb -merge "${HOME}/.Xresources"
. "${HOME}/.cache/wal/colors.sh"

bspc config normal_border_color "$color0"
bspc config focused_border_color "$color15"
dunst \
    -lb "$color0"  \
    -nb "$color0"  \
    -cb "#ff0000"  \
    -lf "$color15" \
    -bf "$color15" \
    -cf "#000000"  \
    -nf "$color15" &

notify-send "[wal-set] done" -t 1
